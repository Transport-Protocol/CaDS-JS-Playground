/*
 playground 2017-08-16 
*/

"use strict";function flattenUnsubscriptionErrors(r){return r.reduce(function(r,t){return r.concat(t instanceof UnsubscriptionError_1.UnsubscriptionError?t.errors:t)},[])}var isArray_1=require("./util/isArray"),isObject_1=require("./util/isObject"),isFunction_1=require("./util/isFunction"),tryCatch_1=require("./util/tryCatch"),errorObject_1=require("./util/errorObject"),UnsubscriptionError_1=require("./util/UnsubscriptionError"),Subscription=function(){function r(r){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,r&&(this._unsubscribe=r)}return r.prototype.unsubscribe=function(){var r,t=!1;if(!this.closed){var i=this,s=i._parent,n=i._parents,e=i._unsubscribe,o=i._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var c=-1,u=n?n.length:0;s;)s.remove(this),s=++c<u&&n[c]||null;if(isFunction_1.isFunction(e)&&(a=tryCatch_1.tryCatch(e).call(this))===errorObject_1.errorObject&&(t=!0,r=r||(errorObject_1.errorObject.e instanceof UnsubscriptionError_1.UnsubscriptionError?flattenUnsubscriptionErrors(errorObject_1.errorObject.e.errors):[errorObject_1.errorObject.e])),isArray_1.isArray(o))for(c=-1,u=o.length;++c<u;){var b=o[c];if(isObject_1.isObject(b)){var a=tryCatch_1.tryCatch(b.unsubscribe).call(b);if(a===errorObject_1.errorObject){t=!0,r=r||[];var p=errorObject_1.errorObject.e;p instanceof UnsubscriptionError_1.UnsubscriptionError?r=r.concat(flattenUnsubscriptionErrors(p.errors)):r.push(p)}}}if(t)throw new UnsubscriptionError_1.UnsubscriptionError(r)}},r.prototype.add=function(t){if(!t||t===r.EMPTY)return r.EMPTY;if(t===this)return this;var i=t;switch(typeof t){case"function":i=new r(t);case"object":if(i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if("function"!=typeof i._addParent){var s=i;(i=new r)._subscriptions=[s]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(i),i._addParent(this),i},r.prototype.remove=function(r){var t=this._subscriptions;if(t){var i=t.indexOf(r);-1!==i&&t.splice(i,1)}},r.prototype._addParent=function(r){var t=this,i=t._parent,s=t._parents;i&&i!==r?s?-1===s.indexOf(r)&&s.push(r):this._parents=[r]:this._parent=r},r.EMPTY=function(r){return r.closed=!0,r}(new r),r}();exports.Subscription=Subscription;